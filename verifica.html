<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Verifica Email — ETA Games</title>
<link rel="stylesheet" href="tvh.css">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

<style>
/* Centra tutto usando il body e card esistente */
body {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
  padding: 20px;
}

.card.centered {
  max-width: 600px;
  width: 100%;
  text-align: center;
  border: 2px solid var(--accent);
  border-radius: 14px;
  padding: 30px;
  box-shadow: 0 0 20px rgba(229,9,20,0.6);
  background: var(--card);
}

.status-row {
  margin: 16px 0;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
}

.btn-row {
  margin-top: 20px;
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
}

.btn {
  padding: 10px 16px;
  font-weight: bold;
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.2s;
}

.btn-primary {
  background: linear-gradient(90deg,var(--accent),#ff4d4d);
  color: #fff;
}

.btn-primary:hover {
  background: linear-gradient(90deg,#ff4d4d,var(--accent));
}

.btn-link {
  background: transparent;
  color: var(--muted);
  text-decoration: underline;
}
</style>
</head>
<body>

<div class="card centered">
  <h1>Controllo email in corso</h1>
  <p>Ti abbiamo inviato una mail di verifica a <strong id="userEmail"></strong>. Controlla la tua posta e clicca sul link di conferma.</p>

  <div class="status-row">
    <span id="statusIcon">⏳</span>
    <p id="statusMsg" class="muted">Aspettando la conferma...</p>
  </div>

  <div class="btn-row">
    <button id="resendBtn" class="btn btn-primary">Reinvia email</button>
    <a href="login.html" class="btn btn-link">Torna al login</a>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCiWCjKAsNYLnDJT1o3r_E3tGLyYTasDPc",
  authDomain: "etagames-b5d6a.firebaseapp.com",
  projectId: "etagames-b5d6a",
  storageBucket: "etagames-b5d6a.firebasestorage.app",
  messagingSenderId: "809625655346",
  appId: "1:809625655346:web:3010a62960fde91787842b",
  measurementId: "G-BG4HGVW7D6"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();

auth.onAuthStateChanged(async (user) => {
  if (!user) { window.location.href = "login.html"; return; }

  const statusIcon = document.getElementById('statusIcon');
  const statusMsg = document.getElementById('statusMsg');
  document.getElementById('userEmail').textContent = user.email;

  function setPending() {
    statusIcon.textContent = '⏳';
    statusMsg.textContent = 'Aspettando la conferma...';
  }

  function setVerified() {
    statusIcon.textContent = '✅';
    statusMsg.textContent = 'Email verificata! Reindirizzamento in corso...';
  }

  if (!user.emailVerified) {
    try {
      await user.sendEmailVerification();
    } catch(err) { console.error(err); }

    setPending();

    const interval = setInterval(async () => {
      await user.reload(); // aggiorna lo stato
      if (user.emailVerified) {
        clearInterval(interval);
        setVerified();
        setTimeout(() => window.location.href = "profilo.html", 1500);
      }
    }, 3000); // controlla ogni 3 secondi
  } else {
    setVerified();
    setTimeout(() => window.location.href = "profilo.html", 1500);
  }

  document.getElementById('resendBtn').addEventListener('click', async () => {
    try {
      await user.sendEmailVerification();
      alert("Email di verifica reinviata!");
      setPending();
    } catch(err) {
      alert(err.message);
    }
  });
});
</script>

</body>
</html>
